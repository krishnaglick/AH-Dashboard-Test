<h1 id="development-mode">Development Mode</h1>

<p><strong>Don&rsquo;t use this in production!</strong></p>

<h2 id="about">About</h2>
<pre class="highlight javascript"><code><span class="nx">config</span><span class="p">.</span><span class="nx">general</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">developmentMode</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>

<p>actionhero&rsquo;s development mode is a little different than tools like <a href="https://github.com/remy/nodemon">nodemon</a> in that it tries hard not to restart the server process. Changes to routes, tasks, and actions can simply replace those in memory when they are updated on disk. Other changes, like changes to <code class="prettyprint">api.config</code> or initializers are more severe, and will restart the whole application (much like nodemon).</p>

<p>To enable development mode simply set <code class="prettyprint">developmentMode: true</code> in your <code class="prettyprint">config/api.js</code>.</p>

<h2 id="effects-of-development-mode">Effects of Development Mode</h2>

<p>Development mode, when enabled, will poll for changes in your actions, tasks and initializers, and reload them on the fly.</p>

<ul>
<li>this uses <code class="prettyprint">fs.watchFile()</code> and may not work on all OSs / file systems.</li>
<li>new files won&rsquo;t be loaded in, only existing files when the app was booted will be monitored</li>
<li>as deleting a file might crash your application, we will not attempt to re-load deleted files</li>
<li>if you have changed the <code class="prettyprint">task.frequency</code> of a periodic task, you will continue to use the old value until the task fires at least once after the change </li>
<li>changing <code class="prettyprint">api.config</code>, initializers, or servers, will attempt to do a &ldquo;full&rdquo; reboot the server rather than just reload that component.</li>
</ul>

<h2 id="watching-custom-files">Watching custom files</h2>
<pre class="highlight javascript"><code><span class="nx">api</span><span class="p">.</span><span class="nx">watchFileAndAct</span><span class="p">(</span><span class="nx">path_to_file</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'rebooting due to config change: '</span> <span class="o">+</span> <span class="nx">path_to_file</span><span class="p">,</span> <span class="s1">'info'</span><span class="p">);</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">restart</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">api</span><span class="p">.</span><span class="nx">_self</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>

<p>You can use actionhero&rsquo;s <code class="prettyprint">watchFileAndAct()</code> method to watch additional files your application may have:</p>

<h2 id="debugging">Debugging</h2>

<p>You can use the awesome <a href="https://github.com/dannycoates/node-inspector">node-inspector</a> project to help you debug your actionhero application within the familar Chrome Browser&rsquo;s developer tools.</p>

<p>Be sure to run actionhero with node&rsquo;s <code class="prettyprint">--debug</code> flag, ie: <code class="prettyprint">node ./node_modules/.bin/actionhero start --debug</code></p>
<pre class="highlight javascript"><code><span class="c1">// in package.json</span>
<span class="s2">"dependencies"</span><span class="err">:</span> <span class="p">{</span>
  <span class="s2">"actionhero"</span><span class="err">:</span> <span class="s2">"x"</span><span class="p">,</span>
  <span class="s2">"node-inspector"</span><span class="err">:</span> <span class="s2">"x"</span>
<span class="p">},</span>
</code></pre>

<p>Start up node-inspector (both node-inspector and actionhero have the same default port, so you will need to change one of them) <code class="prettyprint">./node_modules/.bin/node-inspector --web-port=1234</code></p>

<p>That&rsquo;s it! Now you can visit <code class="prettyprint">http://0.0.0.0:1234/debug?port=5858</code> and start debugging.  Remember that the way node-debugger works has you first set a breakpoint in the file view, and then you can use the console to inspect various objects.  IE: I put a breakpoint in the default <code class="prettyprint">status</code> action in the <code class="prettyprint">run</code> method:</p>

<h2 id="repl">REPL</h2>
<pre class="highlight shell"><code><span class="gp">&gt; </span>grunt console
Running <span class="s2">"console"</span> task
2015-11-14 17:48:01 - notice: <span class="k">***</span> starting actionhero <span class="k">***</span>
2015-11-14 17:48:01 - warning: running with fakeredis
2015-11-14 17:48:01 - info: actionhero member 10.0.1.15 has joined the cluster
2015-11-14 17:48:01 - notice: pid: 38464
2015-11-14 17:48:01 - notice: server ID: 10.0.1.15
2015-11-14 17:48:01 - info: ensuring the existence of the chatRoom: defaultRoom
2015-11-14 17:48:01 - info: ensuring the existence of the chatRoom: anotherRoom
2015-11-14 17:48:01 - notice: environment: development
2015-11-14 17:48:01 - notice: <span class="k">***</span> Server Started @ 2015-11-14 17:48:01 <span class="k">***</span>
<span class="o">[</span> AH::development <span class="o">]</span> &gt;&gt; api.id
<span class="s1">'10.0.1.15'</span>
<span class="o">[</span> AH::development <span class="o">]</span> &gt;&gt; Object.keys<span class="o">(</span>api.actions.actions<span class="o">)</span>
<span class="o">[</span> <span class="s1">'cacheTest'</span>,
  <span class="s1">'randomNumber'</span>,
  <span class="s1">'showDocumentation'</span>,
  <span class="s1">'sleepTest'</span>,
  <span class="s1">'status'</span> <span class="o">]</span>
</code></pre>

<p>actionhero now has a REPL (<code class="prettyprint">v9.0.0</code>)! This means you can &lsquo;connect&rsquo; to a running instance of actionhero and manually call all the methods on the <code class="prettyprint">api</code> namespace.  This combined with the new RPC tools make this a powerful debugging and development tool.  Running <code class="prettyprint">grunt console</code> will load up a version of action hero in your terminal where you have access to the <code class="prettyprint">api</code> object.  This version of the server will <code class="prettyprint">boot</code>, <code class="prettyprint">initialize</code>, and <code class="prettyprint">start</code>, but will skip booting any <code class="prettyprint">servers</code>.  </p>

<p>The REPL will:</p>

<ul>
<li>source <code class="prettyprint">NODE_ENV</code> properly to load the config</li>
<li>will connect to redis and load any user-defined initializers</li>
<li>will load any plugins</li>
<li>will <strong>not</strong> boot any servers</li>
</ul>

<p>If you are familiar with rails, this is very similar to <code class="prettyprint">rails console</code></p>

<p><img src="https://cloud.githubusercontent.com/assets/303226/2953485/4db6cbe2-da5b-11e3-96de-26fe4931d9af.png"></p>
